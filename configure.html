<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Configure Your Gear ‚Äî ProKit Studio</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #111410;
    --bg2: #1a1d16;
    --bg3: #222620;
    --border: #2e332a;
    --gold: #c9a84c;
    --gold-light: #e8c96d;
    --green: #2d6a4f;
    --green-light: #3a8563;
    --white: #f0ece3;
    --muted: #7a7d74;
    --cream: #d6d2c8;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  html { scroll-behavior:smooth; }
  body { font-family:'DM Sans',sans-serif; background:var(--bg); color:var(--white); min-height:100vh; overflow-x:hidden; }

  /* NAV */
  nav { display:flex; align-items:center; justify-content:space-between; padding:1.2rem 2.5rem; border-bottom:1px solid var(--border); background:var(--bg); position:sticky; top:0; z-index:100; }
  .logo { font-family:'Bebas Neue',sans-serif; font-size:1.5rem; letter-spacing:0.08em; color:var(--white); text-decoration:none; }
  .logo span { color:var(--gold); }
  .nav-back { font-size:0.82rem; font-weight:500; letter-spacing:0.06em; text-transform:uppercase; color:var(--muted); text-decoration:none; display:flex; align-items:center; gap:0.5rem; transition:color 0.2s; }
  .nav-back:hover { color:var(--white); }

  /* LAYOUT */
  .app { display:grid; grid-template-columns:380px 1fr; height:calc(100vh - 61px); overflow:hidden; }

  /* LEFT PANEL */
  .steps-panel { background:var(--bg2); border-right:1px solid var(--border); overflow-y:auto; height:100%; padding:2rem 1.8rem; }
  .panel-title { font-family:'DM Mono',monospace; font-size:0.65rem; letter-spacing:0.2em; text-transform:uppercase; color:var(--muted); margin-bottom:1.5rem; }

  /* STEP BLOCKS */
  .step-block { margin-bottom:0.8rem; border:1px solid var(--border); border-radius:4px; transition:all 0.3s; }
  .step-block.locked { opacity:0.4; pointer-events:none; }
  .step-block.active { border-color:var(--gold); }
  .step-block.completed { border-color:var(--green); }
  .step-header { display:flex; align-items:center; gap:0.8rem; padding:1rem; cursor:pointer; user-select:none; }
  .step-num-badge { width:28px; height:28px; border-radius:50%; background:var(--bg3); border:1px solid var(--border); display:flex; align-items:center; justify-content:center; flex-shrink:0; }
  .step-block.active .step-num-badge { background:var(--gold); border-color:var(--gold); }
  .step-block.completed .step-num-badge { background:var(--green); border-color:var(--green); }
  .step-num-badge-num { font-size:0.72rem; font-weight:700; color:var(--muted); }
  .step-block.active .step-num-badge-num,
  .step-block.completed .step-num-badge-num { color:white; }
  .step-header-text { flex:1; }
  .step-label { font-size:0.62rem; font-family:'DM Mono',monospace; letter-spacing:0.15em; text-transform:uppercase; color:var(--muted); }
  .step-title { font-size:0.9rem; font-weight:600; color:var(--white); }
  .step-selection { font-size:0.75rem; color:var(--gold); margin-top:0.2rem; }
  .step-chevron { color:var(--muted); font-size:0.7rem; transition:transform 0.3s; }
  .step-block.active .step-chevron { transform:rotate(180deg); color:var(--gold); }
  .step-content { display:none; padding:1.2rem; background:var(--bg); border-top:1px solid var(--border); }
  .step-block.active .step-content { display:block; }

  /* PRODUCT GRID */
  .product-grid { display:grid; grid-template-columns:1fr 1fr; gap:0.6rem; }
  .product-card { border:1px solid var(--border); border-radius:4px; padding:1rem; cursor:pointer; text-align:center; transition:all 0.2s; background:var(--bg2); }
  .product-card:hover { border-color:var(--gold); background:var(--bg3); }
  .product-card.selected { border-color:var(--gold); background:rgba(201,168,76,0.08); }
  .product-card.coming-soon { opacity:0.35; cursor:not-allowed; pointer-events:none; }
  .product-icon { font-size:2rem; margin-bottom:0.4rem; }
  .product-name { font-size:0.78rem; font-weight:600; letter-spacing:0.04em; }
  .product-soon { font-size:0.62rem; color:var(--muted); margin-top:0.2rem; font-family:'DM Mono',monospace; letter-spacing:0.1em; }

  /* STYLE LIST */
  .style-option { display:flex; align-items:center; justify-content:space-between; padding:0.85rem; border:1px solid var(--border); border-radius:4px; cursor:pointer; margin-bottom:0.5rem; background:var(--bg2); transition:all 0.2s; }
  .style-option:hover { border-color:var(--gold); }
  .style-option.selected { border-color:var(--gold); background:rgba(201,168,76,0.08); }
  .style-name { font-size:0.88rem; font-weight:600; color:var(--white); }
  .style-desc { font-size:0.72rem; color:var(--muted); margin-top:0.15rem; }
  .style-check { color:var(--gold); opacity:0; font-size:0.9rem; }
  .style-option.selected .style-check { opacity:1; }
  .minimum-note { font-size:0.68rem; font-family:'DM Mono',monospace; color:var(--gold); background:rgba(201,168,76,0.08); border:1px solid rgba(201,168,76,0.2); border-radius:3px; padding:0.4rem 0.7rem; margin-bottom:0.8rem; letter-spacing:0.05em; }

  /* CUSTOMIZE */
  .customize-section { margin-bottom:1.5rem; }
  .customize-label { font-size:0.7rem; font-family:'DM Mono',monospace; letter-spacing:0.14em; text-transform:uppercase; color:var(--muted); margin-bottom:0.8rem; display:flex; align-items:center; gap:0.5rem; }
  .customize-label::after { content:''; flex:1; height:1px; background:var(--border); }
  .color-swatches { display:flex; gap:0.5rem; flex-wrap:wrap; }
  .swatch { width:28px; height:28px; border-radius:50%; cursor:pointer; border:2px solid transparent; transition:transform 0.15s,border-color 0.15s,box-shadow 0.15s; position:relative; }
  .swatch:hover { transform:scale(1.15); }
  .swatch.active { border-color:var(--gold); box-shadow:0 0 0 3px rgba(201,168,76,0.25); transform:scale(1.15); }
  .swatch[title]:hover::after { content:attr(title); position:absolute; bottom:130%; left:50%; transform:translateX(-50%); background:var(--bg3); border:1px solid var(--border); color:var(--white); font-size:0.65rem; padding:0.2rem 0.5rem; border-radius:3px; white-space:nowrap; pointer-events:none; }
  .patch-options { display:grid; grid-template-columns:1fr 1fr; gap:0.5rem; }
  .patch-option { border:1px solid var(--border); border-radius:4px; padding:0.7rem; cursor:pointer; text-align:center; background:var(--bg2); transition:all 0.2s; font-size:0.8rem; color:var(--white); }
  .patch-option:hover { border-color:var(--gold); }
  .patch-option.selected { border-color:var(--gold); background:rgba(201,168,76,0.08); color:var(--gold); }
  .patch-icon { font-size:1.3rem; display:block; margin-bottom:0.3rem; }

  /* BUTTONS */
  .add-to-order-btn { width:100%; padding:0.85rem; background:var(--gold); color:var(--bg); font-size:0.85rem; font-weight:700; letter-spacing:0.08em; text-transform:uppercase; border:none; border-radius:4px; cursor:pointer; transition:background 0.2s,transform 0.15s; margin-top:1rem; }
  .add-to-order-btn:hover { background:var(--gold-light); transform:translateY(-1px); }
  .view-order-btn { width:100%; padding:0.75rem; background:transparent; color:var(--muted); font-size:0.82rem; font-weight:600; letter-spacing:0.05em; text-transform:uppercase; border:1px solid var(--border); border-radius:4px; cursor:pointer; margin-top:0.5rem; transition:color 0.2s,border-color 0.2s; }
  .view-order-btn:hover { color:var(--white); border-color:var(--white); }

  /* RIGHT PANEL ‚Äî Preview */
  .preview-panel { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:3rem; position:relative; background:#ffffff; border-left:1px solid #e0ddd8; overflow:hidden; height:100%; }
  .preview-label { font-family:'DM Mono',monospace; font-size:0.65rem; letter-spacing:0.2em; text-transform:uppercase; color:#999; margin-bottom:2rem; align-self:flex-start; }
  .hat-stage { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; width:100%; max-width:500px; gap:1.5rem; }

  /* ANGLE SWITCHER */
  .angle-switcher { display:none; gap:0.5rem; align-self:center; background:#f0ede8; border-radius:6px; padding:4px; }
  .angle-switcher.visible { display:flex; }
  .angle-btn { padding:0.45rem 1.1rem; border:none; border-radius:4px; background:transparent; color:#999; font-size:0.75rem; font-weight:600; letter-spacing:0.07em; text-transform:uppercase; cursor:pointer; transition:all 0.2s; font-family:'DM Sans',sans-serif; }
  .angle-btn.active { background:#ffffff; color:#1a3c2b; box-shadow:0 1px 4px rgba(0,0,0,0.1); }
  .angle-btn:hover:not(.active) { color:#555; }

  .hat-view { display:none; width:100%; max-width:400px; filter:drop-shadow(0 16px 36px rgba(0,0,0,0.12)); animation:floatHat 5s ease-in-out infinite; }
  .hat-view.active { display:block; }
  @keyframes floatHat { 0%,100% { transform:translateY(0px) rotate(-1deg); } 50% { transform:translateY(-10px) rotate(1deg); } }

  .product-illustration { width:340px; height:340px; display:flex; align-items:center; justify-content:center; }

  .preview-placeholder { text-align:center; color:#bbb; }
  .placeholder-icon { font-size:4rem; opacity:0.3; margin-bottom:1rem; }
  .placeholder-text { font-size:0.9rem; line-height:1.6; }

  .preview-meta { margin-top:2rem; display:flex; gap:0.6rem; flex-wrap:wrap; justify-content:center; }
  .meta-tag { background:#f5f5f5; border:1px solid #e0ddd8; padding:0.35rem 0.9rem; border-radius:20px; font-size:0.75rem; color:#666; font-family:'DM Mono',monospace; letter-spacing:0.05em; transition:all 0.3s; }
  .meta-tag.lit { border-color:var(--gold); color:#b8913a; background:rgba(201,168,76,0.08); }

  /* TOAST */
  .toast { position:fixed; bottom:2rem; left:50%; transform:translateX(-50%) translateY(100px); opacity:0; background:var(--green); color:white; padding:0.9rem 1.5rem; border-radius:4px; font-size:0.88rem; font-weight:600; transition:all 0.4s ease; z-index:999; white-space:nowrap; }
  .toast.show { transform:translateX(-50%) translateY(0); opacity:1; }

  /* CART BADGE */
  .cart-badge { position:fixed; top:1rem; right:1.5rem; z-index:200; background:var(--gold); color:var(--bg); font-family:'DM Sans',sans-serif; font-size:0.78rem; font-weight:700; padding:0.5rem 1.1rem; border-radius:4px; cursor:pointer; display:none; align-items:center; gap:0.5rem; box-shadow:0 4px 14px rgba(0,0,0,0.3); transition:background 0.2s,transform 0.15s; }
  .cart-badge:hover { background:var(--gold-light); transform:translateY(-1px); }
  .cart-count { background:var(--bg); color:var(--gold); border-radius:50%; width:20px; height:20px; display:flex; align-items:center; justify-content:center; font-size:0.7rem; font-weight:800; }

  /* CART DRAWER */
  .cart-drawer { position:fixed; top:0; right:-440px; width:420px; height:100vh; background:var(--bg2); border-left:1px solid var(--border); z-index:300; transition:right 0.35s cubic-bezier(0.4,0,0.2,1); display:flex; flex-direction:column; }
  .cart-drawer.open { right:0; }
  .cart-drawer-header { padding:1.5rem; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; flex-shrink:0; }
  .cart-drawer-title { font-family:'Bebas Neue',sans-serif; font-size:1.4rem; letter-spacing:0.05em; color:var(--white); }
  .cart-close { background:none; border:none; color:var(--muted); font-size:1.3rem; cursor:pointer; padding:0.2rem 0.5rem; transition:color 0.2s; }
  .cart-close:hover { color:var(--white); }
  .cart-items { flex:1; overflow-y:auto; padding:1rem; }
  .cart-empty { text-align:center; color:var(--muted); padding:3rem 1rem; font-size:0.9rem; line-height:1.8; }
  .cart-item { background:var(--bg3); border:1px solid var(--border); border-radius:4px; padding:1rem; margin-bottom:0.7rem; }
  .cart-item-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:0.7rem; }
  .cart-item-name { font-weight:700; font-size:0.92rem; color:var(--white); }
  .cart-item-product { font-size:0.68rem; color:var(--muted); font-family:'DM Mono',monospace; }
  .cart-item-remove { background:none; border:none; color:var(--muted); cursor:pointer; font-size:0.78rem; transition:color 0.2s; }
  .cart-item-remove:hover { color:#e55; }
  .cart-item-specs { display:flex; flex-wrap:wrap; gap:0.4rem; margin-bottom:0.8rem; }
  .cart-spec-tag { background:var(--bg); border:1px solid var(--border); border-radius:12px; padding:0.2rem 0.6rem; font-size:0.68rem; font-family:'DM Mono',monospace; color:var(--cream); display:flex; align-items:center; gap:0.3rem; }
  .cart-spec-dot { width:8px; height:8px; border-radius:50%; border:1px solid rgba(255,255,255,0.2); flex-shrink:0; }
  .cart-item-qty { display:flex; align-items:center; gap:0.6rem; }
  .cart-item-qty label { font-size:0.68rem; font-family:'DM Mono',monospace; text-transform:uppercase; letter-spacing:0.1em; color:var(--muted); }
  .qty-input { background:var(--bg); border:1px solid var(--border); color:var(--white); font-family:'DM Sans',sans-serif; font-size:0.85rem; padding:0.3rem 0.5rem; border-radius:3px; width:65px; text-align:center; }
  .qty-input:focus { outline:none; border-color:var(--gold); }
  .cart-minimum { font-size:0.65rem; color:var(--gold); font-family:'DM Mono',monospace; margin-left:auto; }
  .cart-footer { padding:1.2rem; border-top:1px solid var(--border); flex-shrink:0; }
  .cart-submit-btn { width:100%; padding:0.9rem; background:var(--green); color:white; font-size:0.85rem; font-weight:700; letter-spacing:0.08em; text-transform:uppercase; border:none; border-radius:4px; cursor:pointer; transition:background 0.2s; margin-bottom:0.5rem; }
  .cart-submit-btn:hover { background:var(--green-light); }
  .cart-clear-btn { width:100%; padding:0.6rem; background:transparent; color:var(--muted); font-size:0.78rem; border:1px solid var(--border); border-radius:4px; cursor:pointer; transition:color 0.2s; }
  .cart-clear-btn:hover { color:var(--white); }
  .drawer-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:299; opacity:0; pointer-events:none; transition:opacity 0.3s; }
  .drawer-overlay.open { opacity:1; pointer-events:all; }

  /* SUMMARY MODAL */
  .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.6); backdrop-filter:blur(4px); z-index:400; display:flex; align-items:center; justify-content:center; opacity:0; pointer-events:none; transition:opacity 0.3s; }
  .modal-overlay.open { opacity:1; pointer-events:all; }
  .modal { background:#1a1d16; border:1px solid #2e332a; border-radius:6px; width:90%; max-width:520px; padding:2.5rem; transform:translateY(20px); transition:transform 0.3s; }
  .modal-overlay.open .modal { transform:translateY(0); }
  .modal-title { font-family:'Bebas Neue',sans-serif; font-size:2rem; color:#f0ece3; letter-spacing:0.05em; margin-bottom:0.3rem; }
  .modal-subtitle { font-size:0.82rem; color:#7a7d74; margin-bottom:2rem; font-family:'DM Mono',monospace; letter-spacing:0.08em; text-transform:uppercase; }
  .summary-grid { display:grid; grid-template-columns:1fr 1fr; gap:1px; background:#2e332a; border:1px solid #2e332a; border-radius:4px; overflow:hidden; margin-bottom:2rem; }
  .summary-item { background:#111410; padding:1rem 1.2rem; }
  .summary-item-label { font-size:0.65rem; font-family:'DM Mono',monospace; letter-spacing:0.15em; text-transform:uppercase; color:#7a7d74; margin-bottom:0.4rem; }
  .summary-item-value { font-size:0.92rem; font-weight:600; color:#f0ece3; display:flex; align-items:center; gap:0.5rem; }
  .summary-color-dot { width:14px; height:14px; border-radius:50%; border:1px solid rgba(255,255,255,0.15); flex-shrink:0; }
  .modal-actions { display:flex; gap:0.8rem; }
  .modal-confirm { flex:1; padding:0.9rem; background:#2d6a4f; color:white; font-size:0.85rem; font-weight:700; letter-spacing:0.08em; text-transform:uppercase; border:none; border-radius:4px; cursor:pointer; transition:background 0.2s; }
  .modal-confirm:hover { background:#3a8563; }
  .modal-cancel { padding:0.9rem 1.5rem; background:transparent; color:#7a7d74; font-size:0.85rem; font-weight:600; border:1px solid #2e332a; border-radius:4px; cursor:pointer; transition:color 0.2s; }
  .modal-cancel:hover { color:#f0ece3; }
</style>
</head>
<body>

<!-- NAV -->
<nav>
  <a href="index.html" class="logo">ProKit<span>Studio</span></a>
  <a href="index.html" class="nav-back">‚Üê Back to Home</a>
</nav>

<!-- CART BADGE -->
<div class="cart-badge" id="cart-badge" onclick="openCart()">
  üõí View Order <div class="cart-count" id="cart-count">0</div>
</div>

<!-- DRAWER OVERLAY -->
<div class="drawer-overlay" id="drawer-overlay" onclick="closeCart()"></div>

<!-- CART DRAWER -->
<div class="cart-drawer" id="cart-drawer">
  <div class="cart-drawer-header">
    <div class="cart-drawer-title">Your Order</div>
    <button class="cart-close" onclick="closeCart()">‚úï</button>
  </div>
  <div class="cart-items" id="cart-items">
    <div class="cart-empty">No items yet.<br>Configure a product and tap<br>"Add to Order" to get started.</div>
  </div>
  <div class="cart-footer">
    <button class="cart-submit-btn" onclick="submitFullOrder()">Submit Full Order ‚Üí</button>
    <button class="cart-clear-btn" onclick="clearOrder()">Clear Order</button>
  </div>
</div>

<!-- SUMMARY MODAL -->
<div class="modal-overlay" id="modal-overlay">
  <div class="modal">
    <div class="modal-title">Review Item</div>
    <div class="modal-subtitle">Confirm before adding to order</div>
    <div class="summary-grid">
      <div class="summary-item"><div class="summary-item-label">Product</div><div class="summary-item-value" id="sum-product">‚Äî</div></div>
      <div class="summary-item"><div class="summary-item-label">Style</div><div class="summary-item-value" id="sum-style">‚Äî</div></div>
      <div class="summary-item"><div class="summary-item-label" id="sum-crown-label">Crown Color</div><div class="summary-item-value"><div class="summary-color-dot" id="sum-crown-dot"></div><span id="sum-crown">‚Äî</span></div></div>
      <div class="summary-item"><div class="summary-item-label" id="sum-brim-label">Brim Color</div><div class="summary-item-value"><div class="summary-color-dot" id="sum-brim-dot"></div><span id="sum-brim">‚Äî</span></div></div>
      <div class="summary-item"><div class="summary-item-label">Logo / Patch</div><div class="summary-item-value" id="sum-patch">‚Äî</div></div>
      <div class="summary-item"><div class="summary-item-label">Min. Order</div><div class="summary-item-value" id="sum-minimum" style="color:var(--gold)">‚Äî</div></div>
    </div>
    <div class="modal-actions">
      <button class="modal-cancel" onclick="closeModal()">‚Üê Go Back</button>
      <button class="modal-confirm" onclick="confirmAddToOrder()">Add to Order ‚Üí</button>
    </div>
  </div>
</div>

<!-- APP -->
<div class="app">

  <!-- LEFT: STEPS -->
  <div class="steps-panel">
    <p class="panel-title">Configuration Wizard</p>

    <!-- STEP 1 -->
    <div class="step-block active" id="step1">
      <div class="step-header" onclick="toggleStep(1)">
        <div class="step-num-badge"><span class="step-num-badge-num">1</span></div>
        <div class="step-header-text">
          <div class="step-label">Step 1</div>
          <div class="step-title">Choose Your Product</div>
          <div class="step-selection" id="step1-selection"></div>
        </div>
        <div class="step-chevron">‚ñº</div>
      </div>
      <div class="step-content">
        <div class="product-grid">
          <div class="product-card" onclick="selectProduct(this,'Headwear','üß¢')">
            <div class="product-icon">üß¢</div>
            <div class="product-name">Headwear</div>
          </div>
          <div class="product-card" onclick="selectProduct(this,'Polos','üëî')">
            <div class="product-icon">üëî</div>
            <div class="product-name">Polos</div>
          </div>
          <div class="product-card" onclick="selectProduct(this,'Quarter Zips','üß•')">
            <div class="product-icon">üß•</div>
            <div class="product-name">Quarter Zips</div>
          </div>
          <div class="product-card" onclick="selectProduct(this,'Belts','ü™£')">
            <div class="product-icon" style="font-size:1.8rem">üîó</div>
            <div class="product-name">Belts</div>
          </div>
          <div class="product-card coming-soon">
            <div class="product-icon">üëú</div>
            <div class="product-name">Bags</div>
            <div class="product-soon">Coming Soon</div>
          </div>
          <div class="product-card coming-soon">
            <div class="product-icon">üß£</div>
            <div class="product-name">Accessories</div>
            <div class="product-soon">Coming Soon</div>
          </div>
        </div>
      </div>
    </div>

    <!-- STEP 2 -->
    <div class="step-block locked" id="step2">
      <div class="step-header" onclick="toggleStep(2)">
        <div class="step-num-badge"><span class="step-num-badge-num">2</span></div>
        <div class="step-header-text">
          <div class="step-label">Step 2</div>
          <div class="step-title">Choose Your Style</div>
          <div class="step-selection" id="step2-selection"></div>
        </div>
        <div class="step-chevron">‚ñº</div>
      </div>
      <div class="step-content">
        <div id="minimum-note" class="minimum-note" style="display:none"></div>
        <div class="style-list" id="style-list"></div>
      </div>
    </div>

    <!-- STEP 3 -->
    <div class="step-block locked" id="step3">
      <div class="step-header" onclick="toggleStep(3)">
        <div class="step-num-badge"><span class="step-num-badge-num">3</span></div>
        <div class="step-header-text">
          <div class="step-label">Step 3</div>
          <div class="step-title">Customize Your Gear</div>
        </div>
        <div class="step-chevron">‚ñº</div>
      </div>
      <div class="step-content">
        <div id="customize-fields"></div>
        <button class="add-to-order-btn" onclick="showReviewModal()">+ Add to Order</button>
        <button class="view-order-btn" onclick="openCart()">View Current Order</button>
      </div>
    </div>

  </div>

  <!-- RIGHT: PREVIEW -->
  <div class="preview-panel">
    <p class="preview-label">Live Preview</p>
    <div class="hat-stage" id="hat-stage">

      <div class="angle-switcher" id="angle-switcher">
        <button class="angle-btn active" onclick="setAngle('front',this)">Front</button>
        <button class="angle-btn" onclick="setAngle('side',this)">Side</button>
        <button class="angle-btn" onclick="setAngle('back',this)">Back</button>
      </div>

      <div class="preview-placeholder" id="preview-placeholder">
        <div class="placeholder-icon">üß¢</div>
        <p class="placeholder-text">Select a product to see<br>your live preview</p>
      </div>

      <!-- FRONT VIEW -->
      <svg id="hat-front" class="hat-view" style="display:none" viewBox="0 0 400 360" fill="none" xmlns="http://www.w3.org/2000/svg">
        <ellipse cx="200" cy="322" rx="150" ry="16" fill="rgba(0,0,0,0.07)"/>
        <path id="f-crown" d="M88 295 Q82 205 108 148 Q148 78 200 72 Q252 78 292 148 Q318 205 312 295 Z" fill="#1a3c2b"/>
        <path d="M292 148 Q318 205 312 295 L270 295 Q295 210 278 148 Z" fill="rgba(0,0,0,0.08)"/>
        <path d="M108 148 Q82 205 88 295 L130 295 Q105 210 122 148 Z" fill="rgba(0,0,0,0.05)"/>
        <path d="M200 72 Q212 160 215 295" stroke="rgba(0,0,0,0.08)" stroke-width="1.2"/>
        <path d="M200 72 Q188 160 185 295" stroke="rgba(0,0,0,0.08)" stroke-width="1.2"/>
        <path d="M200 72 Q255 118 290 178" stroke="rgba(0,0,0,0.06)" stroke-width="1"/>
        <path d="M200 72 Q145 118 110 178" stroke="rgba(0,0,0,0.06)" stroke-width="1"/>
        <path d="M90 280 Q200 272 310 280" stroke="rgba(0,0,0,0.15)" stroke-width="2.5" fill="none"/>
        <path id="f-brim-under" d="M88 295 Q76 276 96 268 L304 268 Q324 276 312 295 Z" fill="#a8883a"/>
        <path id="f-brim" d="M88 295 Q80 272 108 264 L292 264 Q320 272 312 295 Z" fill="#c9a84c"/>
        <path d="M110 266 Q200 259 290 266" stroke="rgba(255,255,255,0.12)" stroke-width="1.5" fill="none"/>
        <!-- Rope detail (shown for rope hats) -->
        <g id="f-rope" style="display:none">
          <path d="M92 266 Q200 258 308 266" stroke="#c9a84c" stroke-width="4" fill="none" stroke-linecap="round"/>
          <path d="M92 266 Q200 258 308 266" stroke="rgba(0,0,0,0.2)" stroke-width="4" fill="none" stroke-dasharray="6,5" stroke-linecap="round"/>
        </g>
        <circle id="f-eyelet1" cx="262" cy="182" r="5" fill="none" stroke="#c9a84c" stroke-width="1.5"/>
        <circle cx="262" cy="182" r="2.5" fill="rgba(0,0,0,0.3)"/>
        <circle id="f-eyelet2" cx="138" cy="182" r="5" fill="none" stroke="#c9a84c" stroke-width="1.5"/>
        <circle cx="138" cy="182" r="2.5" fill="rgba(0,0,0,0.3)"/>
        <g id="f-patch">
          <rect id="f-patch-bg" x="155" y="162" width="90" height="64" rx="5" fill="#1a3c2b"/>
          <rect x="159" y="166" width="82" height="56" rx="3" fill="none" stroke="rgba(201,168,76,0.3)" stroke-width="1"/>
          <text id="f-patch-text" x="200" y="198" text-anchor="middle" fill="#c9a84c" font-size="12" font-family="Arial" font-weight="bold" letter-spacing="1.5">YOUR LOGO</text>
          <text id="f-patch-sub" x="200" y="214" text-anchor="middle" fill="rgba(201,168,76,0.45)" font-size="7.5" font-family="Arial" letter-spacing="2.5">EST. 2025</text>
        </g>
        <circle id="f-button" cx="200" cy="77" r="9" fill="rgba(0,0,0,0.28)"/>
        <g id="f-strap">
          <rect x="168" y="288" width="64" height="16" rx="3" fill="#1a1a1a" opacity="0.8"/>
          <rect x="184" y="293" width="32" height="6" rx="2" fill="#2a2a2a"/>
          <circle cx="218" cy="296" r="2.2" fill="#444"/>
          <circle cx="212" cy="296" r="2.2" fill="#444"/>
          <circle cx="206" cy="296" r="2.2" fill="#444"/>
          <circle cx="200" cy="296" r="2.2" fill="#444"/>
        </g>
      </svg>

      <!-- SIDE VIEW -->
      <svg id="hat-side" class="hat-view" style="display:none" viewBox="0 0 420 360" fill="none" xmlns="http://www.w3.org/2000/svg">
        <ellipse cx="195" cy="322" rx="145" ry="14" fill="rgba(0,0,0,0.07)"/>
        <path id="s-crown" d="M100 295 Q95 215 115 160 Q140 100 180 80 Q215 65 248 72 Q278 80 295 115 Q308 145 305 295 Z" fill="#1a3c2b"/>
        <path d="M100 295 Q95 215 115 160 Q140 100 180 80 L185 80 Q148 105 130 162 Q112 218 118 295 Z" fill="rgba(255,255,255,0.04)"/>
        <path d="M248 72 Q278 80 295 115 Q308 145 305 295 L285 295 Q298 148 285 114 Q270 82 248 75 Z" fill="rgba(0,0,0,0.1)"/>
        <path d="M248 72 Q262 140 265 295" stroke="rgba(0,0,0,0.08)" stroke-width="1.2"/>
        <path d="M180 80 Q170 160 168 295" stroke="rgba(0,0,0,0.06)" stroke-width="1"/>
        <path d="M102 280 Q200 270 304 280" stroke="rgba(0,0,0,0.18)" stroke-width="2.5" fill="none"/>
        <path id="s-brim-under" d="M100 295 Q90 278 30 285 Q15 288 18 298 Q22 308 40 306 Q75 302 104 300 Z" fill="#8a7030"/>
        <path id="s-brim" d="M100 295 Q92 272 28 278 Q12 280 14 292 Q16 300 36 298 Q72 294 105 290 Z" fill="#c9a84c"/>
        <path d="M95 275 Q55 276 25 281" stroke="rgba(255,255,255,0.15)" stroke-width="1.2" fill="none"/>
        <!-- Rope (side view - runs along brim junction) -->
        <g id="s-rope" style="display:none">
          <path d="M103 278 Q200 268 304 276" stroke="#c9a84c" stroke-width="4" fill="none" stroke-linecap="round"/>
          <path d="M103 278 Q200 268 304 276" stroke="rgba(0,0,0,0.2)" stroke-width="4" fill="none" stroke-dasharray="6,5" stroke-linecap="round"/>
        </g>
        <circle id="s-eyelet" cx="268" cy="178" r="5" fill="none" stroke="#c9a84c" stroke-width="1.5"/>
        <circle cx="268" cy="178" r="2.5" fill="rgba(0,0,0,0.3)"/>
        <circle id="s-button" cx="215" cy="72" r="9" fill="rgba(0,0,0,0.28)"/>
        <g id="s-strap">
          <rect x="285" y="288" width="28" height="14" rx="2" fill="#1a1a1a" opacity="0.7"/>
        </g>
      </svg>

      <!-- BACK VIEW -->
      <svg id="hat-back" class="hat-view" style="display:none" viewBox="0 0 400 360" fill="none" xmlns="http://www.w3.org/2000/svg">
        <ellipse cx="200" cy="322" rx="145" ry="14" fill="rgba(0,0,0,0.07)"/>
        <path id="b-crown" d="M90 295 Q84 208 110 152 Q148 85 200 80 Q252 85 290 152 Q316 208 310 295 Z" fill="#1a3c2b"/>
        <path d="M90 295 Q84 208 110 152 Q148 85 200 80 L200 84 Q150 92 115 155 Q90 212 96 295 Z" fill="rgba(0,0,0,0.07)"/>
        <path d="M290 152 Q316 208 310 295 L304 295 Q310 208 284 155 Q250 88 200 84 L200 80 Q252 85 290 152 Z" fill="rgba(0,0,0,0.07)"/>
        <path d="M200 80 L200 295" stroke="rgba(0,0,0,0.12)" stroke-width="2"/>
        <path d="M200 80 Q255 118 288 175" stroke="rgba(0,0,0,0.06)" stroke-width="1"/>
        <path d="M200 80 Q145 118 112 175" stroke="rgba(0,0,0,0.06)" stroke-width="1"/>
        <path d="M92 280 Q200 272 308 280" stroke="rgba(0,0,0,0.18)" stroke-width="3" fill="none"/>
        <rect x="92" y="272" width="216" height="10" rx="2" fill="rgba(0,0,0,0.1)"/>
        <!-- Rope (back view) -->
        <g id="b-rope" style="display:none">
          <path d="M92 272 Q200 264 308 272" stroke="#c9a84c" stroke-width="4" fill="none" stroke-linecap="round"/>
          <path d="M92 272 Q200 264 308 272" stroke="rgba(0,0,0,0.2)" stroke-width="4" fill="none" stroke-dasharray="6,5" stroke-linecap="round"/>
        </g>
        <circle id="b-eyelet1" cx="260" cy="180" r="5" fill="none" stroke="#c9a84c" stroke-width="1.5"/>
        <circle cx="260" cy="180" r="2.5" fill="rgba(0,0,0,0.3)"/>
        <circle id="b-eyelet2" cx="140" cy="180" r="5" fill="none" stroke="#c9a84c" stroke-width="1.5"/>
        <circle cx="140" cy="180" r="2.5" fill="rgba(0,0,0,0.3)"/>
        <!-- Snapback strap detail -->
        <g id="b-strap">
          <rect x="148" y="278" width="104" height="22" rx="3" fill="#111111"/>
          <rect x="152" y="282" width="96" height="14" rx="2" fill="#1a1a1a"/>
          <circle cx="172" cy="289" r="2.5" fill="#333"/>
          <circle cx="181" cy="289" r="2.5" fill="#333"/>
          <circle cx="190" cy="289" r="2.5" fill="#333"/>
          <circle cx="199" cy="289" r="2.5" fill="#333"/>
          <circle cx="208" cy="289" r="2.5" fill="#333"/>
          <circle cx="217" cy="289" r="2.5" fill="#333"/>
          <circle cx="226" cy="289" r="2.5" fill="#333"/>
          <rect x="234" y="283" width="10" height="12" rx="2" fill="#222"/>
          <circle cx="239" cy="289" r="3" fill="#444"/>
          <circle cx="239" cy="289" r="1.5" fill="#555"/>
        </g>
        <rect x="178" y="260" width="44" height="14" rx="2" fill="rgba(255,255,255,0.04)"/>
        <text x="200" y="271" text-anchor="middle" fill="rgba(255,255,255,0.15)" font-size="6" font-family="Arial" letter-spacing="1">ONE SIZE</text>
      </svg>

      <!-- Product illustration (non-headwear) -->
      <div class="product-illustration" id="product-illustration" style="display:none"></div>

    </div>

    <div class="preview-meta" id="preview-meta">
      <span class="meta-tag" id="tag-product">No product selected</span>
      <span class="meta-tag" id="tag-style">No style selected</span>
      <span class="meta-tag" id="tag-crown">Color: ‚Äî</span>
      <span class="meta-tag" id="tag-patch">Patch: ‚Äî</span>
    </div>
  </div>

</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
  // ‚îÄ‚îÄ STATE ‚îÄ‚îÄ
  const state = {
    product: null, style: null,
    crownColor: '#1a3c2b', crownName: 'Forest Green',
    brimColor: '#c9a84c',  brimName: 'Gold',
    stitchColor: '#c9a84c', stitchName: 'Gold',
    patchColor: '#1a3c2b', patch: 'logo',
  };

  const MINIMUMS = {
    'Headwear': 12, 'Polos': 24, 'Quarter Zips': 12, 'Belts': 24,
  };

  const STYLES = {
    Headwear: [
      { name: 'Richardson 112', desc: '6-Panel Structured Snapback', strap: true,  rope: false },
      { name: 'Richardson 258', desc: '6-Panel Rope Hat Snapback',   strap: true,  rope: true  },
      { name: 'Richardson 65',  desc: '5-Panel Trucker Snapback',    strap: true,  rope: false },
      { name: 'Richardson 172', desc: 'Fitted Performance Cap',      strap: false, rope: false },
      { name: 'Richardson 115', desc: 'Washed Chino Twill Dad Hat',  strap: false, rope: false },
    ],
    Polos: [
      { name: 'Classic Pique Polo',   desc: 'Traditional pique weave, tailored fit' },
      { name: 'Performance Polo',     desc: 'Moisture-wicking stretch fabric' },
      { name: 'Tour Polo',            desc: 'Tour-inspired premium feel' },
      { name: 'Ladies Polo',          desc: 'Womens fit, pique fabric' },
    ],
    'Quarter Zips': [
      { name: 'Lightweight Quarter Zip', desc: 'Midlayer fleece, great for cool mornings' },
      { name: 'Performance Quarter Zip', desc: 'Moisture-wicking stretch fabric' },
      { name: 'Sherpa Quarter Zip',      desc: 'Sherpa-lined interior, premium warmth' },
    ],
    Belts: [
      { name: 'Ribbon Belt',  desc: 'Classic woven ribbon, adjustable buckle' },
      { name: 'Leather Belt', desc: 'Full-grain leather, custom emboss' },
      { name: 'Stretch Belt', desc: 'Elastic stretch, performance fit' },
    ],
  };

  const LABEL_MAP = {
    Headwear:      { crown: 'Crown Color',   brim: 'Brim Color',          stitch: 'Stitch & Eyelet' },
    Polos:         { crown: 'Body Color',    brim: 'Collar & Sleeve Trim', stitch: 'Button Color'    },
    'Quarter Zips':{ crown: 'Body Color',    brim: 'Zipper & Collar',      stitch: 'Stitch Color'    },
    Belts:         { crown: 'Belt Color',    brim: 'Buckle Finish',         stitch: 'Stitch Color'    },
  };

  const ALL_COLORS = [
    { hex: '#1a3c2b', name: 'Forest Green' },
    { hex: '#c9a84c', name: 'Gold' },
    { hex: '#1a1a2e', name: 'Navy' },
    { hex: '#8B1A1A', name: 'Cardinal' },
    { hex: '#e0dcd3', name: 'White', border: true },
    { hex: '#2b2b2b', name: 'Charcoal' },
    { hex: '#5c3d1e', name: 'Brown' },
    { hex: '#7a4f7d', name: 'Purple' },
    { hex: '#3a6fa8', name: 'Royal Blue' },
    { hex: '#c0392b', name: 'Red' },
    { hex: '#e67e22', name: 'Orange' },
    { hex: '#f5f5dc', name: 'Khaki', border: true },
  ];

  // ‚îÄ‚îÄ STEP NAVIGATION ‚îÄ‚îÄ
  function toggleStep(n) {
    const b = document.getElementById('step'+n);
    if (b.classList.contains('locked')) return;
    const wasActive = b.classList.contains('active');
    [1,2,3].forEach(i => {
      const el = document.getElementById('step'+i);
      if (!el.classList.contains('locked')) el.classList.remove('active');
    });
    if (!wasActive) b.classList.add('active');
  }

  // ‚îÄ‚îÄ STEP 1: SELECT PRODUCT ‚îÄ‚îÄ
  function selectProduct(el, name, icon) {
    document.querySelectorAll('.product-card').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
    state.product = name;
    state.style = null;
    document.getElementById('step1-selection').textContent = icon + ' ' + name;
    document.getElementById('step2-selection').textContent = '';

    // Populate styles
    const styles = STYLES[name] || [];
    const min = MINIMUMS[name] || 12;
    const minNote = document.getElementById('minimum-note');
    minNote.textContent = 'Minimum order: ' + min + ' units for this product';
    minNote.style.display = 'block';

    document.getElementById('style-list').innerHTML = styles.map(s =>
      '<div class="style-option" onclick="selectStyle(this,\'' + s.name + '\',' + (s.strap || false) + ')">'
      + '<div><div class="style-name">' + s.name + '</div><div class="style-desc">' + s.desc + '</div></div>'
      + '<div class="style-check">‚úì</div></div>'
    ).join('');

    // Reset customize fields
    document.getElementById('customize-fields').innerHTML = '';

    // Show/update preview
    document.getElementById('preview-placeholder').style.display = 'none';
    document.getElementById('hat-svg').style.display = 'none';
    document.getElementById('angle-switcher').classList.remove('visible');

    if (name === 'Headwear') {
      document.getElementById('product-illustration').style.display = 'none';
      document.getElementById('preview-placeholder').style.display = 'block';
    } else {
      document.getElementById('product-illustration').style.display = 'flex';
      updateIllustration();
    }

    updateTag('tag-product', name, true);
    updateTag('tag-style', 'No style selected', false);

    // Advance to step 2
    setTimeout(() => {
      document.getElementById('step1').classList.remove('active');
      document.getElementById('step1').classList.add('completed');
      document.getElementById('step2').classList.remove('locked');
      document.getElementById('step2').classList.add('active');
      document.getElementById('step3').classList.add('locked');
      document.getElementById('step3').classList.remove('active','completed');
    }, 300);
  }

  // ‚îÄ‚îÄ STEP 2: SELECT STYLE ‚îÄ‚îÄ
  function selectStyle(el, name, hasStrap, hasRope) {
    document.querySelectorAll('.style-option').forEach(o => o.classList.remove('selected'));
    el.classList.add('selected');
    state.style = name;
    state.hasRope = hasRope;
    document.getElementById('step2-selection').textContent = name;

    // Show hat for headwear
    if (state.product === 'Headwear') {
      document.getElementById('preview-placeholder').style.display = 'none';
      document.getElementById('angle-switcher').classList.add('visible');
      currentAngle = 'front';
      document.querySelectorAll('.angle-btn').forEach(function(b){ b.classList.remove('active'); });
      document.querySelector('.angle-btn').classList.add('active');
      showHatView('front');
      updateHatDetails(hasStrap, hasRope);
    }

    updateTag('tag-style', name, true);

    setTimeout(() => {
      document.getElementById('step2').classList.remove('active');
      document.getElementById('step2').classList.add('completed');
      document.getElementById('step3').classList.remove('locked');
      document.getElementById('step3').classList.add('active');
      buildCustomizeFields();
    }, 300);
  }

  // ‚îÄ‚îÄ BUILD CUSTOMIZE FIELDS ‚îÄ‚îÄ
  function buildCustomizeFields() {
    const product = state.product;
    const lbls = LABEL_MAP[product] || LABEL_MAP.Headwear;

    const swatchesFor = (part, selectedHex) =>
      ALL_COLORS.map(c =>
        '<div class="swatch ' + (c.hex === selectedHex ? 'active' : '') + '" '
        + 'style="background:' + c.hex + ';' + (c.border ? 'border:1px solid #aaa;' : '') + '" '
        + 'onclick="setColor(this,\'' + part + '\',\'' + c.hex + '\')" '
        + 'title="' + c.name + '"></div>'
      ).join('');

    const patchOpts = [
      {type:'logo', icon:'üñºÔ∏è', label:'Custom Logo'},
      {type:'text', icon:'‚úèÔ∏è', label:'Text Only'},
      {type:'flag', icon:'üìç', label:'Flag Patch'},
      {type:'none', icon:'‚úï',  label:'No Logo'},
    ].map(p =>
      '<div class="patch-option ' + (state.patch === p.type ? 'selected' : '') + '" onclick="setPatch(this,\'' + p.type + '\')">'
      + '<span class="patch-icon">' + p.icon + '</span>' + p.label + '</div>'
    ).join('');

    document.getElementById('customize-fields').innerHTML =
      '<div class="customize-section"><div class="customize-label">' + lbls.crown + '</div>'
      + '<div class="color-swatches">' + swatchesFor('crown', state.crownColor) + '</div></div>'
      + '<div class="customize-section"><div class="customize-label">' + lbls.brim + '</div>'
      + '<div class="color-swatches">' + swatchesFor('brim', state.brimColor) + '</div></div>'
      + '<div class="customize-section"><div class="customize-label">' + lbls.stitch + '</div>'
      + '<div class="color-swatches">' + swatchesFor('stitch', state.stitchColor) + '</div></div>'
      + '<div class="customize-section"><div class="customize-label">Logo / Patch</div>'
      + '<div class="patch-options">' + patchOpts + '</div></div>'
      + '<div class="customize-section" id="patch-color-section"'
      + (state.patch === 'none' ? ' style="display:none"' : '') + '>'
      + '<div class="customize-label">Patch Color</div>'
      + '<div class="color-swatches">' + swatchesFor('patch', state.patchColor) + '</div></div>';
  }

  // ‚îÄ‚îÄ SET COLOR ‚îÄ‚îÄ
  function setColor(el, part, color) {
    el.parentElement.querySelectorAll('.swatch').forEach(s => s.classList.remove('active'));
    el.classList.add('active');
    const name = el.getAttribute('title');

    function setAttr(ids, attr, val) {
      ids.forEach(function(id){ var el=document.getElementById(id); if(el) el.setAttribute(attr,val); });
    }
    if (part === 'crown') {
      state.crownColor = color; state.crownName = name;
      setAttr(['f-crown','s-crown','b-crown'], 'fill', color);
      setAttr(['f-button','s-button'], 'fill', shadeColor(color, -30));
      updateTag('tag-crown', 'Crown: ' + name, true);
    } else if (part === 'brim') {
      state.brimColor = color; state.brimName = name;
      setAttr(['f-brim','s-brim'], 'fill', color);
      setAttr(['f-brim-under','s-brim-under'], 'fill', shadeColor(color, -20));
      // Update rope color to match brim
      ['f-rope','s-rope','b-rope'].forEach(function(id){
        var g = document.getElementById(id);
        if(g){ var paths = g.querySelectorAll('path'); if(paths[0]) paths[0].setAttribute('stroke', color); }
      });
    } else if (part === 'stitch') {
      state.stitchColor = color; state.stitchName = name;
      setAttr(['f-eyelet1','f-eyelet2','s-eyelet','b-eyelet1','b-eyelet2'], 'stroke', color);
    } else if (part === 'patch') {
      state.patchColor = color;
      setAttr(['f-patch-bg'], 'fill', color);
      var pt = document.getElementById('f-patch-text');
      if(pt) pt.setAttribute('fill', isLight(color) ? '#1a1a1a' : '#c9a84c');
    }
    updateIllustration();
  }

  // ‚îÄ‚îÄ SET PATCH ‚îÄ‚îÄ
  function setPatch(el, type) {
    document.querySelectorAll('.patch-option').forEach(o => o.classList.remove('selected'));
    el.classList.add('selected');
    state.patch = type;

    const svgPatch = document.getElementById('f-patch');
    const pcs = document.getElementById('patch-color-section');
    const textMap = { logo:['YOUR LOGO','EST. 2025'], text:['APPO GC','GOLF CLUB'], flag:['FLAG','PATCH'] };

    if (type === 'none') {
      if (svgPatch) { svgPatch.style.opacity = '0'; svgPatch.style.pointerEvents = 'none'; }
      if (pcs) pcs.style.display = 'none';
    } else {
      if (svgPatch) { svgPatch.style.opacity = '1'; svgPatch.style.pointerEvents = ''; }
      if (pcs) pcs.style.display = '';
      const lbl = textMap[type];
      const pt = document.getElementById('f-patch-text');
      const ps = document.getElementById('f-patch-sub');
      if (pt && lbl) pt.textContent = lbl[0];
      if (ps && lbl) ps.textContent = lbl[1];
    }
    updateTag('tag-patch', 'Patch: ' + ({logo:'Custom Logo',text:'Text',flag:'Flag',none:'None'}[type] || type), true);
    updateIllustration();
  }

  // ‚îÄ‚îÄ ANGLE SWITCHER (headwear) ‚îÄ‚îÄ
  let currentAngle = 'front';

  function showHatView(angle) {
    document.querySelectorAll('.hat-view').forEach(v => v.classList.remove('active'));
    const el = document.getElementById('hat-' + angle);
    if (el) el.classList.add('active');
  }

  function setAngle(angle, btn) {
    currentAngle = angle;
    document.querySelectorAll('.angle-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    showHatView(angle);
  }

  function updateHatDetails(hasStrap, hasRope) {
    // Straps
    ['f-strap','s-strap','b-strap'].forEach(function(id) {
      const el = document.getElementById(id);
      if (el) el.style.display = hasStrap ? 'block' : 'none';
    });
    // Rope
    ['f-rope','s-rope','b-rope'].forEach(function(id) {
      const el = document.getElementById(id);
      if (el) el.style.display = hasRope ? 'block' : 'none';
    });
  }

  // ‚îÄ‚îÄ PRODUCT ILLUSTRATION (non-headwear) ‚îÄ‚îÄ
  function updateIllustration() {
    const el = document.getElementById('product-illustration');
    if (!el || el.style.display === 'none') return;
    if (state.product && state.product !== 'Headwear') {
      el.innerHTML = buildSVG(state.product);
    }
  }

  function buildSVG(product) {
    const c = state.crownColor || '#1a3c2b';
    const b = state.brimColor  || '#c9a84c';
    const s = state.stitchColor || '#c9a84c';
    const p = state.patchColor || '#1a3c2b';
    const dark = shadeColor(c, -40);
    const mid  = shadeColor(c, -20);
    const bDark = shadeColor(b, -30);
    const bDark2 = shadeColor(b, -50);
    const pOn = state.patch !== 'none';
    const pt = isLight(p) ? '#111111' : '#c9a84c';
    const ps = isLight(p) ? '#333333' : 'rgba(201,168,76,0.6)';
    const pLabels = { logo:'YOUR LOGO', text:'APPO GC', flag:'FLAG' };
    const pSubs   = { logo:'EST. 2025', text:'GOLF CLUB', flag:'PATCH' };
    const pl = pLabels[state.patch] || 'LOGO';
    const psl = pSubs[state.patch] || '';

    if (product === 'Polos') {
      const patch = pOn
        ? '<rect x="90" y="145" width="65" height="45" rx="4" fill="'+p+'"/>'
          + '<text x="122" y="168" text-anchor="middle" fill="'+pt+'" font-size="8" font-family="Arial" font-weight="bold" letter-spacing="1">'+pl+'</text>'
          + '<text x="122" y="182" text-anchor="middle" fill="'+ps+'" font-size="6" font-family="Arial">'+psl+'</text>' : '';
      return '<svg viewBox="0 0 300 340" fill="none" style="width:100%;height:100%;filter:drop-shadow(0 12px 28px rgba(0,0,0,0.12))">'
        + '<path d="M75 110 L50 90 L20 130 L45 145 L45 300 L255 300 L255 145 L280 130 L250 90 L225 110 Q200 85 150 85 Q100 85 75 110Z" fill="'+c+'"/>'
        + '<path d="M110 88 Q150 105 190 88 L180 65 Q165 58 150 56 Q135 58 120 65Z" fill="'+mid+'"/>'
        + '<path d="M110 88 Q150 105 190 88" stroke="'+b+'" stroke-width="2.5" fill="none"/>'
        + '<path d="M75 110 L50 90 L20 130 L45 145 L60 130 Z" fill="'+dark+'"/>'
        + '<path d="M225 110 L250 90 L280 130 L255 145 L240 130 Z" fill="'+dark+'"/>'
        + '<path d="M20 130 L45 145" stroke="'+b+'" stroke-width="3"/>'
        + '<path d="M280 130 L255 145" stroke="'+b+'" stroke-width="3"/>'
        + '<line x1="150" y1="90" x2="150" y2="190" stroke="'+mid+'" stroke-width="2"/>'
        + '<circle cx="150" cy="105" r="3" fill="'+b+'"/>'
        + '<circle cx="150" cy="120" r="3" fill="'+b+'"/>'
        + '<circle cx="150" cy="135" r="3" fill="'+b+'"/>'
        + patch
        + '<line x1="45" y1="295" x2="255" y2="295" stroke="'+mid+'" stroke-width="2"/>'
        + '</svg>';
    }

    if (product === 'Quarter Zips') {
      const patch = pOn
        ? '<rect x="88" y="158" width="65" height="45" rx="4" fill="'+p+'"/>'
          + '<text x="120" y="181" text-anchor="middle" fill="'+pt+'" font-size="8" font-family="Arial" font-weight="bold" letter-spacing="1">'+pl+'</text>'
          + '<text x="120" y="195" text-anchor="middle" fill="'+ps+'" font-size="6" font-family="Arial">'+psl+'</text>' : '';
      return '<svg viewBox="0 0 300 360" fill="none" style="width:100%;height:100%;filter:drop-shadow(0 12px 28px rgba(0,0,0,0.12))">'
        + '<path d="M70 120 L45 95 L15 140 L42 155 L42 310 L258 310 L258 155 L285 140 L255 95 L230 120 Q200 92 150 90 Q100 92 70 120Z" fill="'+c+'"/>'
        + '<path d="M70 120 L45 95 L15 140 L42 155 L58 138 Z" fill="'+dark+'"/>'
        + '<path d="M230 120 L255 95 L285 140 L258 155 L242 138 Z" fill="'+dark+'"/>'
        + '<rect x="15" y="138" width="27" height="10" rx="2" fill="'+b+'"/>'
        + '<rect x="258" y="138" width="27" height="10" rx="2" fill="'+b+'"/>'
        + '<path d="M108 92 Q150 108 192 92 L185 68 Q168 60 150 58 Q132 60 115 68Z" fill="'+mid+'"/>'
        + '<path d="M108 92 Q150 108 192 92" stroke="'+b+'" stroke-width="2.5" fill="none"/>'
        + '<rect x="146" y="90" width="8" height="90" rx="2" fill="'+mid+'"/>'
        + '<rect x="143" y="155" width="14" height="8" rx="2" fill="'+b+'"/>'
        + '<circle cx="150" cy="159" r="2" fill="'+dark+'"/>'
        + patch
        + '<rect x="42" y="302" width="216" height="10" rx="3" fill="'+mid+'"/>'
        + '</svg>';
    }

    if (product === 'Belts') {
      const patch = pOn
        ? '<rect x="275" y="78" width="80" height="44" rx="4" fill="'+p+'" opacity="0.9"/>'
          + '<text x="315" y="101" text-anchor="middle" fill="'+pt+'" font-size="9" font-family="Arial" font-weight="bold" letter-spacing="1">'+pl+'</text>'
          + '<text x="315" y="113" text-anchor="middle" fill="'+ps+'" font-size="6" font-family="Arial">'+psl+'</text>' : '';
      return '<svg viewBox="0 0 420 200" fill="none" style="width:100%;height:100%;filter:drop-shadow(0 12px 28px rgba(0,0,0,0.12))">'
        + '<rect x="20" y="70" width="380" height="60" rx="6" fill="'+c+'"/>'
        + '<line x1="20" y1="78" x2="400" y2="78" stroke="'+s+'" stroke-width="1" stroke-dasharray="8,4" opacity="0.5"/>'
        + '<line x1="20" y1="122" x2="400" y2="122" stroke="'+s+'" stroke-width="1" stroke-dasharray="8,4" opacity="0.5"/>'
        + '<rect x="20" y="62" width="78" height="76" rx="6" fill="'+b+'"/>'
        + '<rect x="26" y="68" width="66" height="64" rx="4" fill="'+bDark+'"/>'
        + '<rect x="55" y="65" width="6" height="70" rx="3" fill="'+b+'"/>'
        + '<path d="M58 68 L58 120 L64 115 L64 73 Z" fill="'+bDark2+'"/>'
        + '<circle cx="135" cy="100" r="5" fill="'+dark+'"/>'
        + '<circle cx="160" cy="100" r="5" fill="'+dark+'"/>'
        + '<circle cx="185" cy="100" r="5" fill="'+dark+'"/>'
        + '<circle cx="210" cy="100" r="5" fill="'+dark+'"/>'
        + '<circle cx="235" cy="100" r="5" fill="'+dark+'"/>'
        + patch
        + '</svg>';
    }
    return '';
  }

  // ‚îÄ‚îÄ ORDER CART ‚îÄ‚îÄ
  let orderItems = [];

  function showReviewModal() {
    if (!state.product) { showToast('Please select a product first!'); return; }
    if (!state.style && state.product === 'Headwear') { showToast('Please choose a hat style first!'); return; }
    if (!state.style) state.style = state.product;

    const lbls = LABEL_MAP[state.product] || LABEL_MAP.Headwear;
    const min = MINIMUMS[state.product] || 12;
    const patchLabels = { logo:'Custom Logo', text:'Text Only', flag:'Flag Patch', none:'No Logo' };

    document.getElementById('sum-product').textContent = state.product;
    document.getElementById('sum-style').textContent = state.style;
    document.getElementById('sum-crown-label').textContent = lbls.crown;
    document.getElementById('sum-crown').textContent = state.crownName || 'Forest Green';
    document.getElementById('sum-crown-dot').style.background = state.crownColor;
    document.getElementById('sum-brim-label').textContent = lbls.brim;
    document.getElementById('sum-brim').textContent = state.brimName || 'Gold';
    document.getElementById('sum-brim-dot').style.background = state.brimColor;
    document.getElementById('sum-patch').textContent = patchLabels[state.patch] || state.patch;
    document.getElementById('sum-minimum').textContent = min + ' unit minimum';
    document.getElementById('modal-overlay').classList.add('open');
  }

  function closeModal() {
    document.getElementById('modal-overlay').classList.remove('open');
  }

  function confirmAddToOrder() {
    closeModal();
    const min = MINIMUMS[state.product] || 12;
    orderItems.push({
      id: Date.now(),
      product:   state.product,
      style:     state.style || state.product,
      crownName: state.crownName || 'Forest Green',
      crownHex:  state.crownColor,
      brimName:  state.brimName || 'Gold',
      brimHex:   state.brimColor,
      stitchName:state.stitchName || 'Gold',
      stitchHex: state.stitchColor,
      patch:     state.patch,
      patchHex:  state.patchColor,
      qty: min,
    });
    renderCart();
    updateCartBadge();
    openCart();
    showToast('Added to order!');
  }

  function removeItem(id) {
    orderItems = orderItems.filter(i => i.id !== id);
    renderCart();
    updateCartBadge();
  }

  function updateQty(id, val) {
    const item = orderItems.find(i => i.id === id);
    if (item) item.qty = parseInt(val) || 0;
  }

  function clearOrder() {
    orderItems = [];
    renderCart();
    updateCartBadge();
    showToast('Order cleared');
  }

  function openCart() {
    document.getElementById('cart-drawer').classList.add('open');
    document.getElementById('drawer-overlay').classList.add('open');
  }

  function closeCart() {
    document.getElementById('cart-drawer').classList.remove('open');
    document.getElementById('drawer-overlay').classList.remove('open');
  }

  function updateCartBadge() {
    const badge = document.getElementById('cart-badge');
    document.getElementById('cart-count').textContent = orderItems.length;
    badge.style.display = orderItems.length > 0 ? 'flex' : 'none';
  }

  function renderCart() {
    const el = document.getElementById('cart-items');
    if (!orderItems.length) {
      el.innerHTML = '<div class="cart-empty">No items yet.<br>Configure a product and tap<br>"Add to Order" to get started.</div>';
      return;
    }
    const patchLabels = { logo:'Custom Logo', text:'Text Only', flag:'Flag Patch', none:'No Logo' };
    const lblMap = LABEL_MAP;
    el.innerHTML = orderItems.map(function(item) {
      const min = MINIMUMS[item.product] || 12;
      const lbls = lblMap[item.product] || lblMap.Headwear;
      return '<div class="cart-item">'
        + '<div class="cart-item-header">'
        + '<div><div class="cart-item-name">' + item.style + '</div>'
        + '<div class="cart-item-product">' + item.product + '</div></div>'
        + '<button class="cart-item-remove" onclick="removeItem(' + item.id + ')">‚úï Remove</button>'
        + '</div>'
        + '<div class="cart-item-specs">'
        + '<div class="cart-spec-tag"><div class="cart-spec-dot" style="background:' + item.crownHex + '"></div>' + lbls.crown + ': ' + item.crownName + '</div>'
        + '<div class="cart-spec-tag"><div class="cart-spec-dot" style="background:' + item.brimHex + '"></div>' + lbls.brim + ': ' + item.brimName + '</div>'
        + '<div class="cart-spec-tag">Logo: ' + (patchLabels[item.patch] || item.patch) + '</div>'
        + '</div>'
        + '<div class="cart-item-qty">'
        + '<label>QTY</label>'
        + '<input class="qty-input" type="number" value="' + item.qty + '" min="' + min + '" onchange="updateQty(' + item.id + ',this.value)">'
        + '<div class="cart-minimum">Min. ' + min + ' units</div>'
        + '</div></div>';
    }).join('');
  }

  function submitFullOrder() {
    if (!orderItems.length) { showToast('Your order is empty!'); return; }
    const patchLabels = { logo:'Custom Logo', text:'Text Only', flag:'Flag Patch', none:'No Logo' };
    const win = window.open('', '_blank');
    const itemsHTML = orderItems.map(function(item, i) {
      const min = MINIMUMS[item.product] || 12;
      const lbls = LABEL_MAP[item.product] || LABEL_MAP.Headwear;
      return '<div class="item">'
        + '<div class="item-header"><div class="item-name">' + item.style + '</div>'
        + '<div class="item-num">Item ' + (i+1) + ' of ' + orderItems.length + '</div></div>'
        + '<div class="specs">'
        + '<div class="spec"><div class="dot" style="background:' + item.crownHex + '"></div><span><span class="lbl">' + lbls.crown + ': </span>' + item.crownName + '</span></div>'
        + '<div class="spec"><div class="dot" style="background:' + item.brimHex + '"></div><span><span class="lbl">' + lbls.brim + ': </span>' + item.brimName + '</span></div>'
        + '<div class="spec"><div class="dot" style="background:' + item.stitchHex + '"></div><span><span class="lbl">' + lbls.stitch + ': </span>' + item.stitchName + '</span></div>'
        + '<div class="spec"><span><span class="lbl">Logo: </span>' + (patchLabels[item.patch]||item.patch) + '</span></div>'
        + '</div>'
        + '<div class="qty-row"><span class="lbl">Quantity: </span><span class="qty">' + item.qty + ' units</span>'
        + '<span class="min">Min. ' + min + ' units</span></div>'
        + '</div>';
    }).join('');

    win.document.write('<!DOCTYPE html><html><head><title>ProKit Studio Order</title>'
      + '<style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:Arial,sans-serif;background:#f8f6f1;color:#1a1a1a;padding:3rem}'
      + '.header{border-bottom:3px solid #1a3c2b;padding-bottom:1.5rem;margin-bottom:2rem;display:flex;justify-content:space-between;align-items:flex-end}'
      + '.logo{font-size:2rem;font-weight:900;letter-spacing:0.05em;color:#1a3c2b}.logo span{color:#c9a84c}'
      + '.date{font-size:0.8rem;color:#888}.title{font-size:1rem;font-weight:700;margin-bottom:1.5rem;color:#1a3c2b;text-transform:uppercase;letter-spacing:0.05em}'
      + '.item{background:white;border:1px solid #e0ddd8;border-radius:6px;padding:1.5rem;margin-bottom:1rem}'
      + '.item-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}'
      + '.item-name{font-size:1.1rem;font-weight:700}.item-num{font-size:0.72rem;background:#1a3c2b;color:white;padding:0.2rem 0.6rem;border-radius:12px}'
      + '.specs{display:grid;grid-template-columns:1fr 1fr;gap:0.5rem;margin-bottom:1rem}'
      + '.spec{padding:0.5rem 0.8rem;background:#f8f6f1;border-radius:3px;font-size:0.82rem;display:flex;gap:0.5rem;align-items:center}'
      + '.dot{width:12px;height:12px;border-radius:50%;border:1px solid rgba(0,0,0,0.1);flex-shrink:0}.lbl{color:#888;font-size:0.72rem}'
      + '.qty-row{display:flex;align-items:center;gap:0.8rem;padding-top:0.8rem;border-top:1px solid #e0ddd8}'
      + '.qty{font-weight:700;color:#1a3c2b}.min{font-size:0.72rem;color:#c9a84c;margin-left:auto}'
      + '.footer{margin-top:2rem;padding-top:1.5rem;border-top:2px solid #1a3c2b;display:flex;justify-content:space-between;font-size:0.8rem;color:#888}'
      + '.total{font-weight:700;color:#1a3c2b}@media print{body{padding:1.5rem}}</style></head><body>'
      + '<div class="header"><div class="logo">ProKit<span>Studio</span></div>'
      + '<div class="date">' + new Date().toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'}) + '</div></div>'
      + '<div class="title">Custom Order Summary</div>'
      + itemsHTML
      + '<div class="footer"><div>Submitted via ProKit Studio</div>'
      + '<div class="total">' + orderItems.length + ' item' + (orderItems.length !== 1 ? 's' : '') + ' in order</div></div>'
      + '<script>window.onload=function(){window.print();}<\/script>'
      + '</body></html>');
    win.document.close();
  }

  // ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ
  function updateTag(id, text, lit) {
    const el = document.getElementById(id);
    if (!el) return;
    el.textContent = text;
    el.classList.toggle('lit', lit);
  }

  function shadeColor(hex, amt) {
    hex = hex.replace('#','');
    if (hex.length === 3) hex = hex.split('').map(function(x){return x+x;}).join('');
    const n = parseInt(hex, 16);
    const R = Math.min(255, Math.max(0, (n>>16) + amt));
    const G = Math.min(255, Math.max(0, ((n>>8)&0xff) + amt));
    const B = Math.min(255, Math.max(0, (n&0xff) + amt));
    return '#' + (0x1000000 + R*0x10000 + G*0x100 + B).toString(16).slice(1);
  }

  function isLight(hex) {
    hex = hex.replace('#','');
    if (hex.length === 3) hex = hex.split('').map(function(x){return x+x;}).join('');
    const n = parseInt(hex, 16);
    const r = (n>>16), g = ((n>>8)&0xff), b = (n&0xff);
    return (r*299 + g*587 + b*114) / 1000 > 128;
  }

  function showToast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.classList.add('show');
    setTimeout(function(){ t.classList.remove('show'); }, 3000);
  }
</script>
</body>
</html>
